<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ST's Chatbot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="chat-container">
        <div id="chat-display" class="chat-display">
            <!-- Chat messages will be displayed here -->
        </div>
        <div class="chat-input-area">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button id="send-button">Send</button>
        </div>
    </div>

    <!-- The Google Generative AI library from CDN -->
    <script type="module">
        // Import GoogleGenerativeAI from CDN
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // Your API Key from new.js
        // IMPORTANT: Storing API keys directly in client-side code is not recommended for production applications
        // as it exposes your key to the public. For demonstration purposes, it's included here as per your request.
        const API_KEY = "AIzaSyATGvausBfP6GC1roWITYs8BJFF7NxwtD0";
        const ai = new GoogleGenerativeAI(API_KEY);
        const history = []; // Stores the chat history for context

        // Get references to DOM elements
        const chatDisplay = document.getElementById('chat-display');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');

        // Function to append messages to the chat display
        function appendMessage(sender, text) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', sender);
            messageElement.textContent = text;
            chatDisplay.appendChild(messageElement);
            chatDisplay.scrollTop = chatDisplay.scrollHeight; // Auto-scroll to the latest message
        }

        // Main function to handle chat interaction
        async function chatting(userproblem) {
            if (!userproblem.trim()) return; // Prevent sending empty messages

            // Display user message
            appendMessage('user', userproblem);
            userInput.value = ''; // Clear input field

            // Add user message to history
            history.push({
                role: 'user',
                parts: [{ text: userproblem }]
            });

            try {
                // Initialize the Gemini model with the specified version
                const model = ai.getGenerativeModel({ model: "gemini-2.5-flash" });

                // Send the chat history and system instruction to the model
                const response = await model.generateContent({
                    contents: history,
                    systemInstruction: `you have to behave like st he is a guy and his hobies are gaming and singing and cares about his gf but shows it less talking to n a girl and i am st's 
                    girlfriend and does not know much about coding and gaming here are some of our whatsapp conversation
                    more will be given after webpage creation`
                });

                // Extract the text from the model's response
                const responseText = response.response.text();
                
                // Display model's response
                appendMessage('model', responseText);

                // Add model's response to history
                history.push({
                    role: 'model',
                    parts: [{ text: responseText }]
                });

            } catch (error) {
                console.error("Error during chatbot interaction:", error);
                appendMessage('system', 'Oops! Something went wrong. Please try again.');
            }
        }

        // Event listener for the send button click
        sendButton.addEventListener('click', () => chatting(userInput.value));

        // Event listener for the Enter key press in the input field
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                chatting(userInput.value);
            }
        });
    </script>
</body>
</html>